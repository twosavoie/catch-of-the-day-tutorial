{"ast":null,"code":"import _regeneratorRuntime from\"/Users/lisasavoie/Desktop/React-For-Beginners-Starter-Files-master/catch-of-the-day/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/lisasavoie/Desktop/React-For-Beginners-Starter-Files-master/catch-of-the-day/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/lisasavoie/Desktop/React-For-Beginners-Starter-Files-master/catch-of-the-day/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/lisasavoie/Desktop/React-For-Beginners-Starter-Files-master/catch-of-the-day/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/Users/lisasavoie/Desktop/React-For-Beginners-Starter-Files-master/catch-of-the-day/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/Users/lisasavoie/Desktop/React-For-Beginners-Starter-Files-master/catch-of-the-day/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/lisasavoie/Desktop/React-For-Beginners-Starter-Files-master/catch-of-the-day/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import firebase from'firebase';import AddFishForm from'./AddFishForm';import EditFishForm from'./EditFishForm';import Login from'./Login';import base,{firebaseApp}from\"../base\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Inventory=/*#__PURE__*/function(_React$Component){_inherits(Inventory,_React$Component);var _super=_createSuper(Inventory);function Inventory(){var _this;_classCallCheck(this,Inventory);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={uid:null,owner:null};_this.authHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(authData){var store;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return base.fetch(_this.props.storeId,{context:_assertThisInitialized(_this)});case 2:store=_context.sent;if(store.owner){_context.next=6;break;}_context.next=6;return base.post(\"\".concat(_this.props.storeId,\"/owner\"),{data:authData.user.uid});case 6:// set the state of the inventory component to reflect the current user\n_this.setState({uid:authData.user.uid,owner:store.owner||authData.user.uid});case 7:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.authenticate=function(provider){var authProvider=new firebase.auth[\"\".concat(provider,\"AuthProvider\")]();firebaseApp.auth().signInWithPopup(authProvider).then(_this.authHandler);};_this.logout=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return firebase.auth().signOut();case 2:_this.setState({uid:null});case 3:case\"end\":return _context2.stop();}},_callee2);}));return _this;}_createClass(Inventory,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;firebase.auth().onAuthStateChanged(function(user){if(user){_this2.authHandler({user:user});}});}},{key:\"render\",value:function render(){var _this3=this;var logout=/*#__PURE__*/_jsx(\"button\",{onClick:this.logout,children:\"Log Out!\"});// check if they are logged in\nif(!this.state.uid){return/*#__PURE__*/_jsx(Login,{authenticate:this.authenticate});}// check if they are not the owner of the store\nif(this.state.uid!==this.state.owner){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Sorry you are not the owner.\"}),logout]});}// they must be the owner, just render the inventory\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"inventory\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Inventory\"}),logout,Object.keys(this.props.fishes).map(function(key){return/*#__PURE__*/_jsx(EditFishForm,{index:key,fish:_this3.props.fishes[key],updateFish:_this3.props.updateFish,deleteFish:_this3.props.deleteFish},key);}),/*#__PURE__*/_jsx(AddFishForm,{addFish:this.props.addFish}),/*#__PURE__*/_jsx(\"button\",{onClick:this.props.loadSampleFishes,children:\"Load Sample Fishes\"})]});}}]);return Inventory;}(React.Component);export default Inventory;","map":{"version":3,"names":["React","firebase","AddFishForm","EditFishForm","Login","base","firebaseApp","Inventory","state","uid","owner","authHandler","authData","fetch","props","storeId","context","store","post","data","user","setState","authenticate","provider","authProvider","auth","signInWithPopup","then","logout","signOut","onAuthStateChanged","Object","keys","fishes","map","key","updateFish","deleteFish","addFish","loadSampleFishes","Component"],"sources":["/Users/lisasavoie/Desktop/React-For-Beginners-Starter-Files-master/catch-of-the-day/src/components/Inventory.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from \"prop-types\";\nimport firebase from 'firebase';\nimport AddFishForm from './AddFishForm';\nimport EditFishForm from './EditFishForm';\nimport Login from './Login';\nimport base, { firebaseApp } from \"../base\";\n\nclass Inventory extends React.Component {\n  static propTypes = {\n    fishes: PropTypes.object,\n    updateFish: PropTypes.func,\n    deleteFish: PropTypes.func,\n    loadSampleFishes: PropTypes.func\n  };\n\n  state = {\n    uid: null,\n    owner: null\n  }\n  componentDidMount() {\n    firebase.auth().onAuthStateChanged(user => {\n      if(user) {\n        this.authHandler({ user });\n      }\n    })\n  }\n  authHandler = async (authData) => {\n    // look up the current store in the firebase database\n    const store = await base.fetch(this.props.storeId, {context: this });\n    // claim it as our own if there is no owner\n    if (!store.owner) {\n      // save it as our own\n      await base.post(`${this.props.storeId}/owner`, {\n        data: authData.user.uid\n      })\n    }\n    // set the state of the inventory component to reflect the current user\n    this.setState({\n      uid: authData.user.uid,\n      owner: store.owner || authData.user.uid\n    })\n  }\n  authenticate = provider => {\n    const authProvider = new firebase.auth[`${provider}AuthProvider`]();\n    firebaseApp\n      .auth()\n      .signInWithPopup(authProvider)\n      .then(this.authHandler);\n  };\n  logout = async () => {\n    await firebase.auth().signOut();\n    this.setState({ uid: null })\n  }\n  render() {\n    const logout = <button onClick={this.logout}>Log Out!</button>;\n    // check if they are logged in\n    if (!this.state.uid) {\n      return <Login authenticate={this.authenticate}/>\n    }\n    // check if they are not the owner of the store\n    if (this.state.uid !== this.state.owner) {\n      return <div>\n        <p>Sorry you are not the owner.</p>\n        {logout}\n      </div>\n    }\n    // they must be the owner, just render the inventory\n    return (\n      <div className=\"inventory\">\n        <h2>Inventory</h2>\n        {logout}\n        {Object.keys(this.props.fishes).map(key => (\n        <EditFishForm \n          key={key}\n          index={key} \n          fish={this.props.fishes[key]} \n          updateFish={this.props.updateFish}\n          deleteFish={this.props.deleteFish}\n          />\n        ))}\n        <AddFishForm addFish={this.props.addFish}/>\n        <button onClick={this.props.loadSampleFishes}>Load Sample Fishes</button>\n      </div>\n    );\n  }\n}\n\nexport default Inventory;"],"mappings":"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"},"metadata":{},"sourceType":"module"}